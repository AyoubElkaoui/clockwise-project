# Clockwise Backend - Docker Compose for Windows Server 2022
# Optimized for 100+ concurrent users
services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.windows
    container_name: clockwise-backend
    ports:
      - "8080:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:8080
      - SEED_ON_START=true
      - DatabaseType=firebird
      - ConnectionStrings__DefaultConnection=Database=C:/app/CLOCKWISE.FDB;User=SYSDBA;Password=masterkey;Dialect=3;Charset=UTF8;ServerType=1;Pooling=true;MinPoolSize=5;MaxPoolSize=100;ConnectionLifetime=300
    volumes:
      - clockwise-data:/app/data
      - ./database:/app/database
    restart: unless-stopped
    # Resource limits for 100+ users
    deploy:
      resources:
        limits:
          cpus: '4.0'
          memory: 4G
        reservations:
          cpus: '2.0'
          memory: 2G
    networks:
      - clockwise-network
    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  clockwise-network:
    driver: nat

volumes:
  clockwise-data:
